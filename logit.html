<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>4 Machine learning with market direction prediction: Logit | Algorithms and Financial programing in R</title>
<meta name="author" content="Arturo Bernal">
<meta name="description" content="Today we will cover machine learning with market direction prediction. In particular, we will forecast the market moves either upward or downward. A logistic regression (Logit) and Linear...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="4 Machine learning with market direction prediction: Logit | Algorithms and Financial programing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.arturo-bernal.com/book/logit.html">
<meta property="og:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<meta property="og:description" content="Today we will cover machine learning with market direction prediction. In particular, we will forecast the market moves either upward or downward. A logistic regression (Logit) and Linear...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="4 Machine learning with market direction prediction: Logit | Algorithms and Financial programing in R">
<meta name="twitter:description" content="Today we will cover machine learning with market direction prediction. In particular, we will forecast the market moves either upward or downward. A logistic regression (Logit) and Linear...">
<meta name="twitter:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Roboto-0.4.1/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68765210-2', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Algorithms and Financial programing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Algorithms and Financial programing in R</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> R Basics</a></li>
<li><a class="" href="clean.html"><span class="header-section-number">2</span> Big data and data cleaning</a></li>
<li><a class="" href="graphs.html"><span class="header-section-number">3</span> APIS and R graphs</a></li>
<li><a class="active" href="logit.html"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></li>
<li><a class="" href="big-data-and-machine-learning.html"><span class="header-section-number">5</span> Big data and machine learning</a></li>
<li><a class="" href="credit-analysis.html"><span class="header-section-number">6</span> Credit analysis</a></li>
<li><a class="" href="rational-agent-and-behavioral-finance-in-investment.html"><span class="header-section-number">7</span> Rational agent and behavioral finance in investment</a></li>
<li><a class="" href="momentum-or-directional-trading.html"><span class="header-section-number">8</span> Momentum or directional trading</a></li>
<li><a class="" href="portfolio-management-algorithms.html"><span class="header-section-number">9</span> Portfolio management algorithms</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/datanalyticss/bookAFMR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="logit" class="section level1" number="4">
<h1>
<span class="header-section-number">4</span> Machine learning with market direction prediction: Logit<a class="anchor" aria-label="anchor" href="#logit"><i class="fas fa-link"></i></a>
</h1>
<p>Today we will cover machine learning with market direction prediction. In particular, we will forecast the market moves either upward or downward.</p>
<p>A logistic regression (Logit) and Linear Discriminant Analysis (LDA) models help us to fit a model using binary behavior (up or down) and forecast market direction. Logistic regression.</p>
<div id="data-preparation" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.quantmod.com">"quantmod"</a></span><span class="op">)</span></span>
<span><span class="va">ticker</span><span class="op">&lt;-</span><span class="st">"BNB-USD"</span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">ticker</span>,from<span class="op">=</span><span class="st">"2021-08-01"</span>,to<span class="op">=</span><span class="st">"2022-04-18"</span>,warnings <span class="op">=</span><span class="cn">FALSE</span>,auto.assign<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"bnb"</span></span>
<span><span class="va">lag2</span><span class="op">&lt;-</span><span class="fl">12</span></span>
<span><span class="va">lag3</span><span class="op">&lt;-</span><span class="fl">9</span></span>
<span><span class="va">lag4</span><span class="op">&lt;-</span><span class="fl">26</span></span>
<span><span class="va">avg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MovingAverages.html">SMA</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span><span class="op">)</span> <span class="co"># var1</span></span>
<span><span class="va">avg2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MovingAverages.html">SMA</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag4</span><span class="op">)</span> <span class="co"># var1</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">avg</span>,<span class="va">avg2</span><span class="op">)</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span></code></pre></div>
<p>The following commands are to create variable direction with either Up direction (1) or Down direction (0). In other words, Up up direction is a signal o buying and and down could be a signal of not buying. For this example, direction variable is created when a short SMA is greater than a long SMA and zero otherwise.</p>
<p>First we make a plot.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#par(mfrow=c(2,1))</span></span>
<span><span class="va">plo0</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">plo</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">plo1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">plo0</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"blue"</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">plo</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"red"</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">plo1</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,col<span class="op">=</span><span class="st">"green"</span>,type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span>x<span class="op">=</span> <span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"actual"</span>,<span class="st">"short-sma"</span>,<span class="st">"long-sma"</span><span class="op">)</span>,lty <span class="op">=</span> <span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"red"</span>,<span class="st">"green"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Clasification-with-Logit_files/figure-html/unnamed-chunk-2-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Now we create the signal.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ifelse(condición,si se cumple la condición,si no se cmple la condición)</span></span>
<span><span class="co"># si el SMA corto &gt; SMA largo, 1,0) </span></span>
<span><span class="va">signal</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="st">"SMA"</span><span class="op">]</span><span class="op">&gt;</span><span class="va">data2</span><span class="op">[</span>,<span class="st">"SMA.1"</span><span class="op">]</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">signal</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Clasification-with-Logit_files/figure-html/unnamed-chunk-3-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># El numero 1 es señal de compra de Binance y cero es no comprar. </span></span></code></pre></div>
<p>As in the machine learning example, where we predict BNB price, our model is:</p>
<p><span class="math display">\[ signal_{t}=\alpha\ +\beta1\ macd_{t-1}+\beta2\ rsi_{t-2} +\beta3\ bb +\ e \]</span></p>
<p>The only difference is the independent variable, in this case is signal.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">std</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollapply.html">rollapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span>,<span class="va">sd</span><span class="op">)</span> <span class="co"># var2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">std</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"std"</span></span>
<span></span>
<span><span class="va">macd</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MACD.html">MACD</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">lag2</span>,<span class="va">lag3</span>,<span class="va">lag4</span>, <span class="st">"SMA"</span><span class="op">)</span> <span class="co"># var2</span></span>
<span><span class="va">macd2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MACD.html">MACD</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fl">11</span>,<span class="fl">25</span>,<span class="fl">8</span>, <span class="st">"SMA"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">macd</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"macd_signal"</span></span>
<span></span>
<span></span>
<span><span class="va">rsi</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/RSI.html">RSI</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span>,<span class="st">"SMA"</span><span class="op">)</span><span class="co"># var3</span></span>
<span><span class="va">rsi2</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/RSI.html">RSI</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="fl">13</span>,<span class="st">"SMA"</span><span class="op">)</span><span class="co"># var3</span></span>
<span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/bollingerBands.html">BBands</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span>, maType<span class="op">=</span><span class="st">"SMA"</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Agregar el nombre de signal en lugar de sig</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">signal</span>,<span class="va">std</span>,<span class="va">macd</span>,<span class="va">rsi</span>,<span class="va">bb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"signal"</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span></code></pre></div>
<p>We separate the sample into training and testing. The training data set is used for the building model process, and the testing dataset is used for evaluation purposes.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_train</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="fl">.8</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">part</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="va">n_train</span><span class="op">]</span></span>
<span><span class="co">#This is the test data set.</span></span>
<span><span class="va">train</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&gt;=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&lt;=</span><span class="va">part</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The subset of the training data set.</span></span>
<span><span class="va">test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&gt;=</span><span class="va">part</span><span class="op">+</span><span class="fl">1</span> <span class="op">&amp;</span></span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&lt;=</span><span class="st">"2022-04-18"</span><span class="op">)</span></span>
<span><span class="va">y1</span><span class="op">&lt;-</span><span class="va">test</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># contiene la varaible que voy a pronosticar</span></span>
<span><span class="co">#test&lt;-test[,-1] # las variables independientes, que voy a usar para haver mi pronóstico</span></span></code></pre></div>
</div>
<div id="logistic-regression" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> Logistic Regression<a class="anchor" aria-label="anchor" href="#logistic-regression"><i class="fas fa-link"></i></a>
</h2>
<p>The linear regression assumes that the response variable Y is quantitative. But in many situations, the response variable is instead qualitative. For example, eye color is qualitative, taking on values blue, brown, or green. Often qualitative variables are referred to as categorical ; we will use these terms interchangeably.</p>
<p>In a binary response model, interest lies primarily in the response probability. However, we can not use the OLS to estimate the model, because it is a not linear binary response model. Then we apply Logistic regression.</p>
<p>glm(y ~.,data= ,family=binomial())</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">signal</span><span class="op">~</span><span class="va">.</span>,data<span class="op">=</span> <span class="va">train</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">model</span>,<span class="va">test</span><span class="op">)</span></span>
<span><span class="va">pred</span></span>
<span><span class="co">#&gt; 2022-03-05 2022-03-06 2022-03-07 2022-03-08 2022-03-09 2022-03-10 2022-03-11 </span></span>
<span><span class="co">#&gt;  1.4071871  0.7838451  1.1688270  1.5835724  0.6400374  1.1018749  1.5094064 </span></span>
<span><span class="co">#&gt; 2022-03-12 2022-03-13 2022-03-14 2022-03-15 2022-03-16 2022-03-17 2022-03-18 </span></span>
<span><span class="co">#&gt; -1.2026024 -2.0134675 -2.4429877 -1.9810255 -0.7260440 -1.5145946 -0.3496281 </span></span>
<span><span class="co">#&gt; 2022-03-19 2022-03-20 2022-03-21 2022-03-22 2022-03-23 2022-03-24 2022-03-25 </span></span>
<span><span class="co">#&gt; -0.7131193 -0.6484040 -1.3564305  1.4355937  1.6560035  2.0060744  3.8742966 </span></span>
<span><span class="co">#&gt; 2022-03-26 2022-03-27 2022-03-28 2022-03-29 2022-03-30 2022-03-31 2022-04-01 </span></span>
<span><span class="co">#&gt;  3.5987035  3.9839923  4.1817522  4.1877168  3.9090570  2.9184529  3.7917209 </span></span>
<span><span class="co">#&gt; 2022-04-02 2022-04-03 2022-04-04 2022-04-05 2022-04-06 2022-04-07 2022-04-08 </span></span>
<span><span class="co">#&gt;  3.4630973  2.7885380  2.6969620  2.6106934  4.1880525  3.2083981  3.0614675 </span></span>
<span><span class="co">#&gt; 2022-04-09 2022-04-10 2022-04-11 2022-04-12 2022-04-13 2022-04-14 2022-04-15 </span></span>
<span><span class="co">#&gt;  2.6747753  2.6183627  1.9073456  2.0025636  0.6854552  1.0431508 -0.2146935 </span></span>
<span><span class="co">#&gt; 2022-04-16 2022-04-17 2022-04-18 </span></span>
<span><span class="co">#&gt; -0.1493334  0.3593882  0.6847538</span></span></code></pre></div>
<p>We expect a forecast of a 0,1 result, as the signal. Then we transform it into a probabilistic model.
exp(x)/(1+exp(x))</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Even when the result is a probability, between 0 and 1, we require a result 0,1. Then we transform it, creating a binary variable, that takes the value of 1 when the probability is higher than 0.5, and zero when is lower than 0.5.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predf</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">prob</span><span class="op">&gt;</span><span class="fl">.5</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">predf</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Clasification-with-Logit_files/figure-html/unnamed-chunk-8-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># comparar vs el dato real que estaé en y1</span></span></code></pre></div>
</div>
<div id="confusion-matrix" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> Confusion matrix<a class="anchor" aria-label="anchor" href="#confusion-matrix"><i class="fas fa-link"></i></a>
</h2>
<p>To measure the accuracy of the prediction, for categorical variables, such as 0,1, confusion matrix is a table that indicates the possible categories of predicted values, and actual values.</p>
<p>Where True Positive (TP): Correctly classified as the class of interest. True Negative (TN) is Correctly classified as not the class of interest. False Positive (FP) is Incorrectly classified as the class of interest. False Negative (FN): Incorrectly classified as not the class of interest.</p>
<p>In the confusion matrix, one of the mesures of interest is the accuracy, defined as:</p>
<p><span class="math display">\[ accuracy =\frac{TP+TN}{TP+TN+FP+FN}\]</span></p>
<p>In this formula, the terms TP, TN, FP, and FN refer to the number of times the model’s predictions fell into each of these categories. The accuracy is therefore a proportion that represents the number of true positives and true negatives, divided by the total number of predictions.</p>
<p>con 7 var
RMSE de 7</p>
<p>con 11 var
RMSE de 6.5</p>
<p>factor(x,levels=c(1,0))
confusionMatrix(pred,real)</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="co"># convertir en data frame  predf</span></span>
<span><span class="va">predf2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">predf</span><span class="op">)</span></span>
<span><span class="va">predf3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">predf2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="co"># niveles, el primer dato, el 1, es  la variable de mi interés. </span></span>
<span><span class="va">real</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">y1</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">predf3</span>,<span class="va">real</span><span class="op">)</span> <span class="co"># primero va la predicción y después el dato real</span></span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  1  0</span></span>
<span><span class="co">#&gt;          1 25  8</span></span>
<span><span class="co">#&gt;          0  0 12</span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt;                Accuracy : 0.8222        </span></span>
<span><span class="co">#&gt;                  95% CI : (0.6795, 0.92)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.5556        </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 0.0001572     </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt;                   Kappa : 0.625         </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : 0.0133283     </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt;             Sensitivity : 1.0000        </span></span>
<span><span class="co">#&gt;             Specificity : 0.6000        </span></span>
<span><span class="co">#&gt;          Pos Pred Value : 0.7576        </span></span>
<span><span class="co">#&gt;          Neg Pred Value : 1.0000        </span></span>
<span><span class="co">#&gt;              Prevalence : 0.5556        </span></span>
<span><span class="co">#&gt;          Detection Rate : 0.5556        </span></span>
<span><span class="co">#&gt;    Detection Prevalence : 0.7333        </span></span>
<span><span class="co">#&gt;       Balanced Accuracy : 0.8000        </span></span>
<span><span class="co">#&gt;                                         </span></span>
<span><span class="co">#&gt;        'Positive' Class : 1             </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="op">(</span><span class="fl">25</span><span class="op">+</span><span class="fl">12</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">25</span><span class="op">+</span><span class="fl">12</span><span class="op">+</span><span class="fl">8</span><span class="op">+</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8222222</span></span></code></pre></div>
<p>Sensitivity</p>
<p>Finding a useful classifier often involves a balance between predictions that are overly conservative and overly aggressive. For example, an e-mail filter could guarantee to eliminate every spam message by aggressively eliminating nearly every ham message at the same time. On the other hand, guaranteeing that no ham message is inadvertently filtered might require us to allow an unacceptable amount of spam to pass through the filter. A pair of performance measures captures this trade off: sensitivity and specificity.</p>
<p>The sensitivity of a model (also called the true positive rate) measures the proportion of positive examples that were correctly classified. Therefore, as shown in the following formula, it is calculated as the number of true positives divided by the total number of positives, both correctly classified (the true positives) as well as incorrectly classified (the false negatives):</p>
<p><span class="math display">\[sensitivity =\frac{TP}{TP+FN}\]</span></p>
</div>
<div id="linear-discriminant-analysis-lda" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> Linear Discriminant Analysis LDA<a class="anchor" aria-label="anchor" href="#linear-discriminant-analysis-lda"><i class="fas fa-link"></i></a>
</h2>
<p>Why do we need another method, when we have logistic regression?
There are several reasons:</p>
<p>• When the classes are well-separated, the parameter estimates for the
logistic regression model are surprisingly unstable. Linear discriminant
analysis does not suffer from this problem.</p>
<p>• If number of observations <em>n</em> is small and the distribution of the predictors X is approximately normal in each of the classes, the linear discriminant model is again more stable than the logistic regression model.</p>
<p>• Finally, when we have more than 2 categories, for example, c(-1,0,1).</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://www.quantmod.com">"quantmod"</a></span><span class="op">)</span></span>
<span><span class="va">ticker</span><span class="op">&lt;-</span><span class="st">"BNB-USD"</span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">ticker</span>,from<span class="op">=</span><span class="st">"2018-08-01"</span>,to<span class="op">=</span><span class="st">"2022-04-18"</span>,warnings <span class="op">=</span><span class="cn">FALSE</span>,auto.assign<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"bnb"</span></span>
<span><span class="va">lag2</span><span class="op">&lt;-</span><span class="fl">12</span></span>
<span><span class="va">lag3</span><span class="op">&lt;-</span><span class="fl">18</span></span>
<span><span class="va">lag4</span><span class="op">&lt;-</span><span class="fl">26</span></span>
<span><span class="va">avg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MovingAverages.html">SMA</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span><span class="op">)</span> <span class="co"># var1</span></span>
<span><span class="va">avg2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MovingAverages.html">SMA</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag3</span><span class="op">)</span> <span class="co"># var1</span></span>
<span><span class="va">avg3</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MovingAverages.html">SMA</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag4</span><span class="op">)</span> <span class="co"># var1</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">avg</span>,<span class="va">avg2</span>,<span class="va">avg3</span><span class="op">)</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">std</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollapply.html">rollapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span>,<span class="va">sd</span><span class="op">)</span> <span class="co"># var2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">std</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"std"</span></span>
<span><span class="va">macd</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/MACD.html">MACD</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">lag2</span>,<span class="va">lag3</span>,<span class="va">lag4</span>, <span class="st">"SMA"</span><span class="op">)</span> <span class="co"># var2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">macd</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"macd_signal"</span></span>
<span><span class="va">rsi</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/RSI.html">RSI</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="va">lag2</span>,<span class="st">"SMA"</span><span class="op">)</span><span class="co"># var3</span></span>
<span><span class="va">bb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TTR/man/bollingerBands.html">BBands</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">10</span>, maType<span class="op">=</span><span class="st">"SMA"</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">data</span>,<span class="va">std</span>,<span class="va">macd</span>,<span class="va">rsi</span>,<span class="va">bb</span><span class="op">)</span></span>
<span><span class="co">#colnames(data2)[1]&lt;-"signal"</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span></span></code></pre></div>
<p>Signal creation, now 3 categories c(-1,0,1)</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&gt;</span> <span class="va">data2</span><span class="op">[</span>,<span class="st">'up'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">data2</span><span class="op">[</span>,<span class="st">'macd'</span><span class="op">]</span><span class="op">&gt;</span> <span class="va">data2</span><span class="op">[</span>,<span class="st">'macd_signal'</span><span class="op">]</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">data2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&lt;</span> <span class="va">data2</span><span class="op">[</span>,<span class="st">'dn'</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">data2</span><span class="op">[</span>,<span class="st">'macd'</span><span class="op">]</span> <span class="op">&lt;</span><span class="va">data2</span><span class="op">[</span>,<span class="st">'macd_signal'</span><span class="op">]</span>,<span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">signal</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="04-Clasification-with-Logit_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>1 es señal de compra, -1 de venta (o venta en corto), y cero es no hacer nada (ni comprar ni vender).</p>
<p>$400 espero que baje 380.</p>
<p>Combinig data2 and signal</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#We first replace bnp by signal </span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="va">data2</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Eliminate up, because is causing issues (correlated with mavg, and does not allow estimate the model)</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="va">data2</span><span class="op">[</span>,<span class="op">-</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="va">data2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">signal</span>,<span class="va">data2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="st">"signal"</span></span></code></pre></div>
<p>Training and test partition</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_train</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">N</span><span class="op">*</span><span class="fl">.8</span>,<span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">part</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="va">n_train</span><span class="op">]</span></span>
<span><span class="co">#This is the test data set.</span></span>
<span><span class="va">train</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&gt;=</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span></span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&lt;=</span><span class="va">part</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The subset of the training data set.</span></span>
<span><span class="va">test</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">data2</span>,</span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&gt;=</span><span class="va">part</span><span class="op">+</span><span class="fl">1</span> <span class="op">&amp;</span></span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">data2</span><span class="op">)</span><span class="op">&lt;=</span><span class="st">"2022-04-18"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">train</span><span class="op">&lt;-</span><span class="va">train</span><span class="op">[</span>,<span class="op">-</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="va">test</span><span class="op">&lt;-</span><span class="va">test</span><span class="op">[</span>,<span class="op">-</span><span class="fl">6</span><span class="op">]</span></span>
<span></span>
<span><span class="va">y1</span><span class="op">&lt;-</span><span class="va">test</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="co"># contiene la varaible que voy a pronosticar</span></span>
<span><span class="co">#test&lt;-test[,-1] # las variables independientes, que voy a usar para haver mi pronóstico</span></span></code></pre></div>
<p>LDA model and prediction
lda(x~.,data= , prior = c(1,1,1)/3)</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span></span>
<span><span class="va">modellda</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lda.html">lda</a></span><span class="op">(</span><span class="va">signal</span><span class="op">~</span><span class="va">.</span>,data<span class="op">=</span> <span class="va">train</span>, prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">modellda</span>,<span class="va">test</span><span class="op">)</span></span>
<span><span class="va">pred</span><span class="op">&lt;-</span><span class="va">pred</span><span class="op">[[</span><span class="st">"class"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "factor"</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span> </span>
<span><span class="va">real</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">y1</span>,levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">pred</span>,<span class="va">real</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Confusion Matrix and Statistics</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           Reference</span></span>
<span><span class="co">#&gt; Prediction  -1   0   1</span></span>
<span><span class="co">#&gt;         -1   8  18   0</span></span>
<span><span class="co">#&gt;         0    0 199   0</span></span>
<span><span class="co">#&gt;         1    0  27  11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Overall Statistics</span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                Accuracy : 0.8289          </span></span>
<span><span class="co">#&gt;                  95% CI : (0.7778, 0.8724)</span></span>
<span><span class="co">#&gt;     No Information Rate : 0.9278          </span></span>
<span><span class="co">#&gt;     P-Value [Acc &gt; NIR] : 1               </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;                   Kappa : 0.4079          </span></span>
<span><span class="co">#&gt;                                           </span></span>
<span><span class="co">#&gt;  Mcnemar's Test P-Value : NA              </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Statistics by Class:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Class: -1 Class: 0 Class: 1</span></span>
<span><span class="co">#&gt; Sensitivity            1.00000   0.8156  1.00000</span></span>
<span><span class="co">#&gt; Specificity            0.92941   1.0000  0.89286</span></span>
<span><span class="co">#&gt; Pos Pred Value         0.30769   1.0000  0.28947</span></span>
<span><span class="co">#&gt; Neg Pred Value         1.00000   0.2969  1.00000</span></span>
<span><span class="co">#&gt; Prevalence             0.03042   0.9278  0.04183</span></span>
<span><span class="co">#&gt; Detection Rate         0.03042   0.7567  0.04183</span></span>
<span><span class="co">#&gt; Detection Prevalence   0.09886   0.7567  0.14449</span></span>
<span><span class="co">#&gt; Balanced Accuracy      0.96471   0.9078  0.94643</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="graphs.html"><span class="header-section-number">3</span> APIS and R graphs</a></div>
<div class="next"><a href="big-data-and-machine-learning.html"><span class="header-section-number">5</span> Big data and machine learning</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#logit"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></li>
<li><a class="nav-link" href="#data-preparation"><span class="header-section-number">4.1</span> Data preparation</a></li>
<li><a class="nav-link" href="#logistic-regression"><span class="header-section-number">4.2</span> Logistic Regression</a></li>
<li><a class="nav-link" href="#confusion-matrix"><span class="header-section-number">4.3</span> Confusion matrix</a></li>
<li><a class="nav-link" href="#linear-discriminant-analysis-lda"><span class="header-section-number">4.4</span> Linear Discriminant Analysis LDA</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/datanalyticss/bookAFMR/blob/master/04-Clasification-with-Logit.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/datanalyticss/bookAFMR/edit/master/04-Clasification-with-Logit.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Algorithms and Financial programing in R</strong>" was written by Arturo Bernal. It was last built on 2022-07-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
