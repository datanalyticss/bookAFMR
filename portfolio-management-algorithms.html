<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>9 Portfolio management algorithms | Algorithms and Financial programing in R</title>
<meta name="author" content="Arturo Bernal">
<meta name="description" content="For this session, we will take the filtered stocks from “Rational agents theory and behavioral finance theories”. As you remember, in the last session we applied the momentum strategy. Also, for...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="9 Portfolio management algorithms | Algorithms and Financial programing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.arturo-bernal.com/book/portfolio-management-algorithms.html">
<meta property="og:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<meta property="og:description" content="For this session, we will take the filtered stocks from “Rational agents theory and behavioral finance theories”. As you remember, in the last session we applied the momentum strategy. Also, for...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="9 Portfolio management algorithms | Algorithms and Financial programing in R">
<meta name="twitter:description" content="For this session, we will take the filtered stocks from “Rational agents theory and behavioral finance theories”. As you remember, in the last session we applied the momentum strategy. Also, for...">
<meta name="twitter:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Roboto-0.4.1/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68765210-2', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Algorithms and Financial programing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Algorithms and Financial programing in R</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> R Basics</a></li>
<li><a class="" href="clean.html"><span class="header-section-number">2</span> Big data and data cleaning</a></li>
<li><a class="" href="graphs.html"><span class="header-section-number">3</span> APIS and R graphs</a></li>
<li><a class="" href="logit.html"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></li>
<li><a class="" href="big-data-and-machine-learning.html"><span class="header-section-number">5</span> Big data and machine learning</a></li>
<li><a class="" href="credit-analysis.html"><span class="header-section-number">6</span> Credit analysis</a></li>
<li><a class="" href="rational-agent-and-behavioral-finance-in-investment.html"><span class="header-section-number">7</span> Rational agent and behavioral finance in investment</a></li>
<li><a class="" href="momentum-or-directional-trading.html"><span class="header-section-number">8</span> Momentum or directional trading</a></li>
<li><a class="active" href="portfolio-management-algorithms.html"><span class="header-section-number">9</span> Portfolio management algorithms</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/datanalyticss/bookAFMR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="portfolio-management-algorithms" class="section level1" number="9">
<h1>
<span class="header-section-number">9</span> Portfolio management algorithms<a class="anchor" aria-label="anchor" href="#portfolio-management-algorithms"><i class="fas fa-link"></i></a>
</h1>
<p>For this session, we will take the filtered stocks from “Rational agents theory and behavioral finance theories”. As you remember, in the last session we applied the momentum strategy. Also, for Activity 2, you must estimate the return, standard deviation, and Sharpe of the first 3 stocks. In the file df_merge.xlsx you will find those estimations for the in_sample and out_sample.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_merge</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"df_merge.xlsx"</span>,rowNames<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p>As we mention in the last session, If the performance on out-sample data is pretty like in-sample data, we assume the parameters and rule set have good generalization power and can be used for live trading. In this session, we filter for those stocks that have similar out-sample and in-sample data. For that purpose, we took the difference between Sharpe ratios in the in_sample and out_sample. We also need to define a threshold of tolerance for that difference. For example, we only take stocks for which the difference is less than 20% in absolute value.<br>
df %&gt;%
filter(Sharpe_diff &lt; n &amp; Sharpe_diff &gt; -n)
n is the threshold</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treh</span><span class="op">&lt;-</span><span class="fl">0.2</span></span>
<span></span>
<span>  <span class="va">df_merge2</span><span class="op">&lt;-</span> <span class="va">df_merge</span>   <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Sharpe_diff</span> <span class="op">&lt;</span> <span class="va">treh</span> <span class="op">&amp;</span> <span class="va">Sharpe_diff</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">treh</span><span class="op">)</span></span>
<span><span class="va">df_merge2</span></span>
<span><span class="co">#&gt;                 in_return     in_sd in_Sharpe   out_return     out_sd</span></span>
<span><span class="co">#&gt; AAPL.Close   -0.054771548 0.2747365   -0.1994 -0.082373325 0.23299812</span></span>
<span><span class="co">#&gt; AMZN.Close   -0.016509915 0.2788159   -0.0592 -0.035770361 0.29049652</span></span>
<span><span class="co">#&gt; TSLA.Close    0.564098218 0.5666686    0.9955  0.532664333 0.45951725</span></span>
<span><span class="co">#&gt; TSM.Close    -0.135791198 0.3021663   -0.4494 -0.121677232 0.22938977</span></span>
<span><span class="co">#&gt; BAC.Close     0.027169757 0.3355819    0.0810 -0.011570730 0.20220638</span></span>
<span><span class="co">#&gt; NSRGF.Close  -0.223354678 0.1760606   -1.2686 -0.210133138 0.15186225</span></span>
<span><span class="co">#&gt; LVMUY.Close  -0.108547037 0.2736889   -0.3966 -0.101687079 0.24380399</span></span>
<span><span class="co">#&gt; BAC.PK.Close  0.017871194 0.1272181    0.1405  0.001189315 0.06644728</span></span>
<span><span class="co">#&gt; RHHBF.Close  -0.667692583 0.3264243   -2.0455 -0.660057680 0.33908716</span></span>
<span><span class="co">#&gt; KO.Close     -0.038464295 0.2080766   -0.1849 -0.023579715 0.12021278</span></span>
<span><span class="co">#&gt; TM.Close     -0.091717493 0.2144692   -0.4276 -0.118928664 0.21121348</span></span>
<span><span class="co">#&gt; RYDAF.Close   0.017644987 0.3660373    0.0482  0.001445751 0.20941036</span></span>
<span><span class="co">#&gt; SHEL.Close   -0.010895257 0.3851020   -0.0283 -0.003778604 0.17708269</span></span>
<span><span class="co">#&gt; BHP.Close    -0.028648261 0.3246614   -0.0882 -0.029134810 0.25596044</span></span>
<span><span class="co">#&gt; VZ.Close     -0.119001044 0.1588481   -0.7491 -0.102977092 0.12531984</span></span>
<span><span class="co">#&gt; AZN.Close    -0.207450467 0.2140546   -0.9691 -0.193951418 0.17725594</span></span>
<span><span class="co">#&gt; AZNCF.Close  -0.372264173 0.2180492   -1.7072 -0.346987471 0.21398241</span></span>
<span><span class="co">#&gt; ADBE.Close   -0.044939517 0.2979994   -0.1508 -0.049712045 0.24744804</span></span>
<span><span class="co">#&gt; NVSEF.Close  -0.095764445 0.2272564   -0.4214 -0.034737903 0.11387070</span></span>
<span><span class="co">#&gt; DIS.Close    -0.045685926 0.2775004   -0.1646 -0.079449603 0.21852916</span></span>
<span><span class="co">#&gt; ORCL.Close   -0.121939597 0.2788517   -0.4373 -0.095171013 0.25138906</span></span>
<span><span class="co">#&gt; WFC.PR.Close -0.002421536 0.1492000   -0.0162  0.002284474 0.05670749</span></span>
<span><span class="co">#&gt; TMUS.Close   -0.216877202 0.2408982   -0.9003 -0.195021363 0.18670398</span></span>
<span><span class="co">#&gt;              out_Sharpe Sharpe_diff</span></span>
<span><span class="co">#&gt; AAPL.Close      -0.3535      0.1541</span></span>
<span><span class="co">#&gt; AMZN.Close      -0.1231      0.0639</span></span>
<span><span class="co">#&gt; TSLA.Close       1.1592     -0.1637</span></span>
<span><span class="co">#&gt; TSM.Close       -0.5304      0.0810</span></span>
<span><span class="co">#&gt; BAC.Close       -0.0572      0.1382</span></span>
<span><span class="co">#&gt; NSRGF.Close     -1.3837      0.1151</span></span>
<span><span class="co">#&gt; LVMUY.Close     -0.4171      0.0205</span></span>
<span><span class="co">#&gt; BAC.PK.Close     0.0179      0.1226</span></span>
<span><span class="co">#&gt; RHHBF.Close     -1.9466     -0.0989</span></span>
<span><span class="co">#&gt; KO.Close        -0.1961      0.0112</span></span>
<span><span class="co">#&gt; TM.Close        -0.5631      0.1355</span></span>
<span><span class="co">#&gt; RYDAF.Close      0.0069      0.0413</span></span>
<span><span class="co">#&gt; SHEL.Close      -0.0213     -0.0070</span></span>
<span><span class="co">#&gt; BHP.Close       -0.1138      0.0256</span></span>
<span><span class="co">#&gt; VZ.Close        -0.8217      0.0726</span></span>
<span><span class="co">#&gt; AZN.Close       -1.0942      0.1251</span></span>
<span><span class="co">#&gt; AZNCF.Close     -1.6216     -0.0856</span></span>
<span><span class="co">#&gt; ADBE.Close      -0.2009      0.0501</span></span>
<span><span class="co">#&gt; NVSEF.Close     -0.3051     -0.1163</span></span>
<span><span class="co">#&gt; DIS.Close       -0.3636      0.1990</span></span>
<span><span class="co">#&gt; ORCL.Close      -0.3786     -0.0587</span></span>
<span><span class="co">#&gt; WFC.PR.Close     0.0403     -0.0565</span></span>
<span><span class="co">#&gt; TMUS.Close      -1.0445      0.1442</span></span></code></pre></div>
<p>The momentum strategy consists of buying stocks when the instrument is trending up or selling when is down. For this case, we will order the sample by the in_Sharpe, and split the sample into 3 tranches. The first will be the stocks for taking long positions and the 3rd the one of shorts positions.</p>
<p>df %&gt;% arrange(desc(col))</p>
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_filtered</span><span class="op">&lt;-</span> <span class="va">df_merge2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span><span class="op">(</span><span class="va">in_Sharpe</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># to gt the names of those stocks</span></span></code></pre></div>
<p>The next code is to make the split for winners</p>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># length te da el número de elementos de un vector</span></span>
<span><span class="co"># rownames te da el nombre de las rwnglones</span></span>
<span><span class="va">co</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">df_filtered</span><span class="op">)</span></span>
<span><span class="va">le</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">co</span><span class="op">)</span></span>
<span><span class="va">n</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">le</span><span class="op">/</span><span class="fl">3</span>,<span class="fl">0</span><span class="op">)</span> <span class="co"># el número de las pocisiones largas y cortas, round para rendondear </span></span>
<span><span class="va">win</span><span class="op">&lt;-</span><span class="va">co</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span> <span class="co"># long positions</span></span>
<span><span class="va">n</span></span>
<span><span class="co">#&gt; [1] 8</span></span></code></pre></div>
<p>The next code is to make the split for losers</p>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># las últimas 8</span></span>
<span><span class="va">loss</span><span class="op">&lt;-</span><span class="va">co</span><span class="op">[</span><span class="op">(</span><span class="va">le</span><span class="op">-</span><span class="va">n</span><span class="op">)</span><span class="op">:</span><span class="va">le</span><span class="op">]</span></span>
<span><span class="va">loss</span> <span class="co"># short positions</span></span>
<span><span class="co">#&gt; [1] "TM.Close"    "ORCL.Close"  "TSM.Close"   "VZ.Close"    "TMUS.Close" </span></span>
<span><span class="co">#&gt; [6] "AZN.Close"   "NSRGF.Close" "AZNCF.Close" "RHHBF.Close"</span></span></code></pre></div>
<p>Finally, we combine the tranches 1 and 3 in one single object</p>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">co_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">win</span>,<span class="va">loss</span><span class="op">)</span></span>
<span><span class="va">co_all</span></span>
<span><span class="co">#&gt;  [1] "TSLA.Close"   "BAC.PK.Close" "BAC.Close"    "RYDAF.Close"  "WFC.PR.Close"</span></span>
<span><span class="co">#&gt;  [6] "SHEL.Close"   "AMZN.Close"   "BHP.Close"    "TM.Close"     "ORCL.Close"  </span></span>
<span><span class="co">#&gt; [11] "TSM.Close"    "VZ.Close"     "TMUS.Close"   "AZN.Close"    "NSRGF.Close" </span></span>
<span><span class="co">#&gt; [16] "AZNCF.Close"  "RHHBF.Close"</span></span></code></pre></div>
<p>We will generate thousands of simulations of the portfolio weights, and we need to generate aleatory numbers for the weights. For the long position, the weights must be positive and for the short position, the weight must be negative. Then, for the first tranche</p>
<p>The function runif will create random numbers if we apply that function to the first tranche, runif(n, 0, 1), n the number of simulations we want. We need to generate the number of random weights that are in the rend_win object.</p>
<p>Regarding the set.seed(42), because runif generate aleatory numbers. Then it is useful to take out the # before set.seed(42) and get the same result. After everyone gets the same results, insert the # again.</p>
<p>For simplicity, we will generate one portfolio weights simulation, and late we will generate more.
runif.</p>
<div class="sourceCode" id="cb167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">w</span><span class="op">&lt;-</span> <span class="fl">1.2</span> <span class="co"># long position weight</span></span>
<span><span class="va">w_short</span><span class="op">&lt;-</span> <span class="fl">1</span><span class="op">-</span><span class="va">w</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="co">#runif </span></span>
<span><span class="va">ru</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">n</span> , <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># weigths sum</span></span>
<span><span class="va">su</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ru</span><span class="op">)</span></span>
<span><span class="co"># runif/sum and trasnsforming into data frame</span></span>
<span><span class="va">we_win</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ru</span><span class="op">*</span><span class="va">w</span><span class="op">/</span><span class="va">su</span><span class="op">)</span></span>
<span><span class="co">#colnanmes weigth</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">we_win</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"we"</span></span>
<span><span class="co"># row names from win</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">we_win</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">win</span></span></code></pre></div>
<p>For the short position the weights must be negative. Then, for the 3rd tranche:</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ru</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">loss</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">su</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ru</span><span class="op">)</span></span>
<span><span class="co"># runif/sum and trasnsforming into data frame</span></span>
<span><span class="va">we_loss</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">ru</span><span class="op">*</span><span class="va">w_short</span><span class="op">/</span><span class="va">su</span><span class="op">)</span> </span>
<span><span class="co">#colnanmes weigth</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">we_loss</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"we"</span></span>
<span><span class="co"># row names from loss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">we_loss</span><span class="op">)</span><span class="op">&lt;-</span><span class="va">loss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">we_loss</span><span class="op">)</span> <span class="co"># set.seed(42)</span></span>
<span><span class="co">#&gt; [1] -0.2</span></span>
<span><span class="va">we_loss</span></span>
<span><span class="co">#&gt;                      we</span></span>
<span><span class="co">#&gt; TM.Close    -0.02150707</span></span>
<span><span class="co">#&gt; ORCL.Close  -0.02308076</span></span>
<span><span class="co">#&gt; TSM.Close   -0.01498448</span></span>
<span><span class="co">#&gt; VZ.Close    -0.02354061</span></span>
<span><span class="co">#&gt; TMUS.Close  -0.03059711</span></span>
<span><span class="co">#&gt; AZN.Close   -0.00836163</span></span>
<span><span class="co">#&gt; NSRGF.Close -0.01513346</span></span>
<span><span class="co">#&gt; AZNCF.Close -0.03077199</span></span>
<span><span class="co">#&gt; RHHBF.Close -0.03202288</span></span></code></pre></div>
<p>Finally, we combine both weights.</p>
<div class="sourceCode" id="cb169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">we_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">we_win</span>,<span class="va">we_loss</span><span class="op">)</span></span>
<span><span class="va">we_all</span></span>
<span><span class="co">#&gt;                       we</span></span>
<span><span class="co">#&gt; TSLA.Close    0.21952864</span></span>
<span><span class="co">#&gt; BAC.PK.Close  0.22487269</span></span>
<span><span class="co">#&gt; BAC.Close     0.06866573</span></span>
<span><span class="co">#&gt; RYDAF.Close   0.19928491</span></span>
<span><span class="co">#&gt; WFC.PR.Close  0.15400152</span></span>
<span><span class="co">#&gt; SHEL.Close    0.12456895</span></span>
<span><span class="co">#&gt; AMZN.Close    0.17676122</span></span>
<span><span class="co">#&gt; BHP.Close     0.03231633</span></span>
<span><span class="co">#&gt; TM.Close     -0.02150707</span></span>
<span><span class="co">#&gt; ORCL.Close   -0.02308076</span></span>
<span><span class="co">#&gt; TSM.Close    -0.01498448</span></span>
<span><span class="co">#&gt; VZ.Close     -0.02354061</span></span>
<span><span class="co">#&gt; TMUS.Close   -0.03059711</span></span>
<span><span class="co">#&gt; AZN.Close    -0.00836163</span></span>
<span><span class="co">#&gt; NSRGF.Close  -0.01513346</span></span>
<span><span class="co">#&gt; AZNCF.Close  -0.03077199</span></span>
<span><span class="co">#&gt; RHHBF.Close  -0.03202288</span></span></code></pre></div>
<p>The portfolio standard deviation is the result of the covariance multiplied by the portfolio weights.</p>
<p>We estimate the covariance matrix, only for the tickers in tranches 1 and 3. For that covariance we need the returs of that tickers only.</p>
<p>Once we have the filtered stocks, get the returns of those stocks, taking the returns that we estimated the last session, from:</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"dfx_2.xlsx"</span><span class="op">)</span></span>
<span><span class="va">date</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">datax</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">data</span>,</span>
<span>         order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">datax</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">datax</span><span class="op">)</span></span>
<span><span class="va">ret</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">datax</span>,<span class="fl">2</span>,<span class="va">Delt</span><span class="op">)</span></span>
<span><span class="va">retx</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">ret</span>,</span>
<span>         order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">retx</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">retx</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">retx</span><span class="op">)</span></span>
<span><span class="co">#&gt;              AAPL.Close   MSFT.Close    GOOG.Close  GOOGL.Close   AMZN.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.009722044 -0.012451750 -0.0049072022 -0.005231342 -0.012139050</span></span>
<span><span class="co">#&gt; 2020-01-06  0.007968248  0.002584819  0.0246570974  0.026654062  0.014885590</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.004703042 -0.009117758 -0.0006240057 -0.001931646  0.002091556</span></span>
<span><span class="co">#&gt; 2020-01-08  0.016086289  0.015928379  0.0078803309  0.007117757 -0.007808656</span></span>
<span><span class="co">#&gt; 2020-01-09  0.021240806  0.012492973  0.0110444988  0.010497921  0.004799272</span></span>
<span><span class="co">#&gt; 2020-01-10  0.002260711 -0.004627059  0.0069726829  0.006458647 -0.009410597</span></span>
<span><span class="co">#&gt;              TSLA.Close  BRK.A.Close   BRK.B.Close    TSM.Close     JNJ.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.029633186 -0.009074946 -0.0096764570 -0.032978014 -0.0115777351</span></span>
<span><span class="co">#&gt; 2020-01-06  0.019254668  0.003110672  0.0035812717 -0.011539821 -0.0012475257</span></span>
<span><span class="co">#&gt; 2020-01-07  0.038800516 -0.003847624 -0.0047138948  0.016204931  0.0061068006</span></span>
<span><span class="co">#&gt; 2020-01-08  0.049204848  0.000846855  0.0003098752  0.007373114 -0.0001378742</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.021945005  0.012013986  0.0117703834  0.008170213  0.0029662802</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.006627343 -0.008966885 -0.0088781940 -0.006246817 -0.0022697641</span></span>
<span><span class="co">#&gt;               UNH.Close   NVDA.Close      V.Close     JPM.Close    XOM.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.010119627 -0.016005985 -0.007953061 -0.0194911055 -0.008039492</span></span>
<span><span class="co">#&gt; 2020-01-06  0.006941973  0.004193620 -0.002162468 -0.0007951424  0.007678103</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.006036629  0.012106623 -0.002642846 -0.0170005865 -0.008184027</span></span>
<span><span class="co">#&gt; 2020-01-08  0.021084181  0.001875597  0.017118003  0.0078009785 -0.015080353</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.005677570  0.010982611  0.006929981  0.0036512341  0.007655626</span></span>
<span><span class="co">#&gt; 2020-01-10  0.003092937  0.005349370  0.002690836 -0.0099679495 -0.008887657</span></span>
<span><span class="co">#&gt;               BAC.Close      PG.Close    WMT.Close     MA.Close    CVX.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.020763104 -0.0067255650 -0.008828006 -0.009756491 -0.003458766</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.001432779  0.0013868331 -0.002035771  0.002662910 -0.003388183</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.006599685 -0.0061914623 -0.009264802 -0.003386183 -0.012769486</span></span>
<span><span class="co">#&gt; 2020-01-08  0.010109821  0.0042626773 -0.003431658  0.016288648 -0.011422821</span></span>
<span><span class="co">#&gt; 2020-01-09  0.001715699  0.0109378498  0.010330552  0.013110455 -0.001614231</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.008278533  0.0009689382 -0.008350409  0.006696884 -0.009105608</span></span>
<span><span class="co">#&gt;             JPM.PC.Close  JPM.PD.Close  NSRGY.Close  NSRGF.Close   LVMUY.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.0035087719  0.0007236252  0.009343229  0.008883944 -0.0089095992</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0020978671 -0.0028922632  0.008065228  0.004035975 -0.0002140839</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0049054308 -0.0029006526 -0.018638022 -0.017083894 -0.0094197925</span></span>
<span><span class="co">#&gt; 2020-01-08  0.0031690141  0.0018181455 -0.014545108 -0.015057116  0.0082126863</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.0007020358 -0.0003629038 -0.004324518 -0.004435227  0.0128617038</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.0007024236  0.0007261438 -0.003965688  0.009573479 -0.0044444233</span></span>
<span><span class="co">#&gt;             BAC.PK.Close     HD.Close  LVMHF.Close BAC.PL.Close    PFE.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.0003654971 -0.003323368 -0.006602660  0.006245253 -0.005365275</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0014614906  0.004704764 -0.006219153  0.002806236 -0.001284402</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0062202708 -0.006546658 -0.004860237  0.004126138 -0.003343631</span></span>
<span><span class="co">#&gt; 2020-01-08  0.0055227909  0.014964255  0.014608657  0.002705518  0.007999982</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0007323691  0.015329858  0.008519702  0.002197802 -0.004352270</span></span>
<span><span class="co">#&gt; 2020-01-10  0.0021953531 -0.004307478 -0.002829981  0.006358529  0.015428132</span></span>
<span><span class="co">#&gt;             RHHBF.Close   RHHBY.Close  RHHVF.Close      KO.Close  BML.PL.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.016002498 -0.0058693325 -0.005822844 -0.0054555917  0.0028829900</span></span>
<span><span class="co">#&gt; 2020-01-06  0.000000000  0.0091020414  0.009093749 -0.0003657159  0.0043121150</span></span>
<span><span class="co">#&gt; 2020-01-07  0.007193082 -0.0078010483 -0.004246265 -0.0076824221 -0.0079738295</span></span>
<span><span class="co">#&gt; 2020-01-08  0.000000000  0.0034397788 -0.002822377  0.0018432811  0.0057708162</span></span>
<span><span class="co">#&gt; 2020-01-09  0.000000000  0.0004897405  0.001261392  0.0182153089  0.0028688115</span></span>
<span><span class="co">#&gt; 2020-01-10  0.000000000  0.0041604992  0.005500009  0.0034333032  0.0008173682</span></span>
<span><span class="co">#&gt;             BAC.PE.Close   ABBV.Close BML.PG.Close  BAC.PB.Close  BML.PH.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.0036023613 -0.009491971 -0.002793296 -0.0003606563  0.0084745763</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0041828862  0.007891827  0.002334220 -0.0018037158  0.0001353408</span></span>
<span><span class="co">#&gt; 2020-01-07  0.0005265521 -0.005704731 -0.001895622 -0.0079508132 -0.0052700617</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.0028559364  0.007087389  0.023365206  0.0036429143 -0.0001313937</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0022504091  0.007707797  0.002416781  0.0025409075  0.0062327291</span></span>
<span><span class="co">#&gt; 2020-01-10  0.0010042457 -0.012748044  0.003502661 -0.0007241491 -0.0032649252</span></span>
<span><span class="co">#&gt;             BML.PJ.Close   AVGO.Close    NVO.Close  NONOF.Close IDCBF.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.0004245435 -0.025435071 -0.021418780 -0.008495163  0.00000000</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0004248088 -0.001495913 -0.001751059 -0.009617066 -0.01282051</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0029750105 -0.003442516 -0.001052394 -0.001059269 -0.01298701</span></span>
<span><span class="co">#&gt; 2020-01-08  0.0080989347 -0.012474491 -0.001755979 -0.006362690  0.00000000</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0080380127 -0.008032584  0.010378206  0.026147243  0.01315789</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.0002558295 -0.022987033  0.021587762  0.012133819 -0.02597403</span></span>
<span><span class="co">#&gt;              IDCBY.Close     PEP.Close    MRK.Close   ASML.Close  ASMLF.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.0217530390 -0.0013989250 -0.008583205 -0.016114570 -0.008484406</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0052321779  0.0038338788  0.004273991 -0.007954438 -0.018624121</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0065746220 -0.0157179515 -0.026625958  0.010860079  0.033202228</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.0006618134  0.0051488846 -0.006726433  0.010375200  0.000000000</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0079470199  0.0006681218  0.008803649 -0.001689390  0.000000000</span></span>
<span><span class="co">#&gt; 2020-01-10  0.0045992116 -0.0019288821  0.001678195 -0.017254005 -0.008604732</span></span>
<span><span class="co">#&gt;                 TM.Close  RYDAF.Close    SHEL.Close    TMO.Close    BHP.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.0104752879  0.006000000  0.0078673750 -0.010877189 -0.006737054</span></span>
<span><span class="co">#&gt; 2020-01-06  0.0001421243  0.009608979  0.0124564028  0.007186692 -0.001099853</span></span>
<span><span class="co">#&gt; 2020-01-07  0.0052567378  0.002625533 -0.0091863026  0.005659088  0.000000000</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.0024732599 -0.013420622 -0.0117550162  0.001590278  0.004954964</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.0046047675 -0.010948905 -0.0001675155  0.006442702 -0.009495910</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.0055511994 -0.010063704 -0.0112265751 -0.002669743  0.002765431</span></span>
<span><span class="co">#&gt;             BHPLF.Close     VZ.Close    AZN.Close    COST.Close AZNCF.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.000000000 -0.010646962 -0.005953542  0.0008234279  0.01500000</span></span>
<span><span class="co">#&gt; 2020-01-06  0.025641063 -0.002152351 -0.004192434  0.0002741816 -0.01773402</span></span>
<span><span class="co">#&gt; 2020-01-07  0.000000000 -0.011116675  0.003809122 -0.0015763408  0.00000000</span></span>
<span><span class="co">#&gt; 2020-01-08  0.000000000  0.001845654 -0.002396625  0.0114638611  0.00000000</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.007720625 -0.014402965  0.002602623  0.0160508024  0.01263793</span></span>
<span><span class="co">#&gt; 2020-01-10  0.007410189  0.002378998 -0.004592731 -0.0072808193  0.00000000</span></span>
<span><span class="co">#&gt;               ABT.Close    NVS.Close  WFC.PY.Close    ADBE.Close  NVSEF.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.012190892 -0.001685055 -0.0007443617 -0.0078342106 -0.016350242</span></span>
<span><span class="co">#&gt; 2020-01-06  0.005239225  0.006751756 -0.0003724395  0.0057261475  0.011796225</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.005559359 -0.009954909 -0.0100596125 -0.0009588445  0.006889264</span></span>
<span><span class="co">#&gt; 2020-01-08  0.004076380  0.000000000  0.0003763643  0.0134376550 -0.002947358</span></span>
<span><span class="co">#&gt; 2020-01-09  0.002667939  0.003069369  0.0011287058  0.0076361235  0.003483974</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.012494227 -0.009602153  0.0030063885 -0.0018799059  0.000000000</span></span>
<span><span class="co">#&gt;                DIS.Close  WFC.PL.Close  CMCSA.Close    ORCL.Close    DHR.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.0114709651  0.0030911938 -0.007934781 -0.0035218350 -0.006189201</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0058020887  0.0071859787 -0.007553877  0.0052083893  0.002984152</span></span>
<span><span class="co">#&gt; 2020-01-07  0.0003433093  0.0041091328  0.005820506  0.0022205588  0.009831214</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.0020590460  0.0044112657  0.010238126 -0.0005538959  0.001024710</span></span>
<span><span class="co">#&gt; 2020-01-09 -0.0039201652  0.0006756757  0.002643732  0.0046185109  0.008829772</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.0014500241 -0.0020256583 -0.011645749  0.0012872379  0.002854043</span></span>
<span><span class="co">#&gt;             WFC.PR.Close WFC.PQ.Close    ACN.Close    CSCO.Close  LRLCF.Close</span></span>
<span><span class="co">#&gt; 2020-01-03  0.0031002410  0.005428954 -0.001665434 -0.0163155108  0.012540442</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0024039148 -0.003239741 -0.006530076  0.0035691370 -0.013899656</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0089500175 -0.006861719 -0.021589983 -0.0064852930 -0.015187754</span></span>
<span><span class="co">#&gt; 2020-01-08  0.0006946162  0.002181782  0.001961502  0.0006316698 -0.003638843</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0024297120 -0.004716945  0.008907121 -0.0042087542  0.007826087</span></span>
<span><span class="co">#&gt; 2020-01-10  0.0000000000  0.004739300  0.007324812 -0.0040151944  0.005625557</span></span>
<span><span class="co">#&gt;             LRLCY.Close CICHF.Close  CICHY.Close    MCD.Close     NKE.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.006258441 -0.03448276 -0.023282225 -0.003535988 -0.0027397163</span></span>
<span><span class="co">#&gt; 2020-01-06  0.003914894  0.00000000 -0.004651163  0.011245502 -0.0008830063</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.023228196  0.04761905 -0.011682301  0.001482741 -0.0004910439</span></span>
<span><span class="co">#&gt; 2020-01-08  0.007811144  0.00000000  0.002364007  0.016187134 -0.0022597367</span></span>
<span><span class="co">#&gt; 2020-01-09  0.005167068  0.01136364  0.010023585  0.011849847 -0.0006893156</span></span>
<span><span class="co">#&gt; 2020-01-10  0.002570202 -0.02247191  0.009924110 -0.005183595 -0.0057154216</span></span>
<span><span class="co">#&gt;               INTC.Close    WFC.Close    C.PJ.Close   TMUS.Close     PM.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.0121630835 -0.006139572  0.0052502275 -0.005344166 -0.001878190</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.0028285858 -0.005990266  0.0000000000  0.005756748  0.011642926</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.0166861338 -0.008286215 -0.0031337048  0.003815759  0.004417636</span></span>
<span><span class="co">#&gt; 2020-01-08  0.0006787884  0.003038359  0.0027942718  0.006335530  0.018981469</span></span>
<span><span class="co">#&gt; 2020-01-09  0.0055960318 -0.001703900 -0.0003482410  0.004910602  0.002726011</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.0060708264 -0.004361843  0.0003483624 -0.010149079 -0.009288627</span></span>
<span><span class="co">#&gt;               AMD.Close    LIN.Close    TXN.Close    BMY.Close     UPS.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.010183300 -0.026003653 -0.013274747 -0.008841190 -0.0005993664</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.004320967 -0.004238507 -0.006961275  0.003185744 -0.0044551405</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.002893139  0.002152762  0.019297456  0.015084154 -0.0017211446</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.008704622  0.012498154  0.002704513 -0.001094932  0.0056896897</span></span>
<span><span class="co">#&gt; 2020-01-09  0.023834392  0.007039910  0.012099315  0.024898152  0.0023143836</span></span>
<span><span class="co">#&gt; 2020-01-10 -0.016336593  0.001101250 -0.010127176 -0.003361253 -0.0090652271</span></span>
<span><span class="co">#&gt;              QCOM.Close</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.018829687</span></span>
<span><span class="co">#&gt; 2020-01-06 -0.005860664</span></span>
<span><span class="co">#&gt; 2020-01-07  0.028436007</span></span>
<span><span class="co">#&gt; 2020-01-08 -0.002922356</span></span>
<span><span class="co">#&gt; 2020-01-09  0.013527280</span></span>
<span><span class="co">#&gt; 2020-01-10  0.003892759</span></span></code></pre></div>
<p>Also, we filter to get only the filtered stocks, from co_all</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># los nombre de las 17 filtradas, log and short </span></span>
<span><span class="co">#subset de las 17 acciones de retx</span></span>
<span><span class="va">retx_all</span><span class="op">&lt;-</span><span class="va">retx</span><span class="op">[</span>,<span class="va">co_all</span><span class="op">]</span></span></code></pre></div>
<p>portfolio covariance
cov(df,use=“complete.obs”)</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covar</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">retx_all</span>,use<span class="op">=</span><span class="st">"complete.obs"</span><span class="op">)</span></span></code></pre></div>
<p>portfolio_std =cov%<em>% weigths
%</em>% para multiplicar matrices</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portfolio_std</span> <span class="op">=</span><span class="va">covar</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">we_all</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">portfolio_std</span></span>
<span><span class="co">#&gt;                      [,1]</span></span>
<span><span class="co">#&gt; TSLA.Close   7.294191e-04</span></span>
<span><span class="co">#&gt; BAC.PK.Close 1.071041e-04</span></span>
<span><span class="co">#&gt; BAC.Close    3.251108e-04</span></span>
<span><span class="co">#&gt; RYDAF.Close  4.231321e-04</span></span>
<span><span class="co">#&gt; WFC.PR.Close 1.213717e-04</span></span>
<span><span class="co">#&gt; SHEL.Close   4.451261e-04</span></span>
<span><span class="co">#&gt; AMZN.Close   2.318799e-04</span></span>
<span><span class="co">#&gt; BHP.Close    3.398317e-04</span></span>
<span><span class="co">#&gt; TM.Close     1.541582e-04</span></span>
<span><span class="co">#&gt; ORCL.Close   1.497664e-04</span></span>
<span><span class="co">#&gt; TSM.Close    2.662127e-04</span></span>
<span><span class="co">#&gt; VZ.Close     6.751342e-05</span></span>
<span><span class="co">#&gt; TMUS.Close   2.029555e-04</span></span>
<span><span class="co">#&gt; AZN.Close    1.142982e-04</span></span>
<span><span class="co">#&gt; NSRGF.Close  9.421821e-05</span></span>
<span><span class="co">#&gt; AZNCF.Close  7.306948e-05</span></span>
<span><span class="co">#&gt; RHHBF.Close  8.447179e-05</span></span></code></pre></div>
<p>But we need annualized the portfolio_std
twe&lt;-t(weigths)
portfolio_std_1=(twe%<em>%portfolio_std</em>252)^.5</p>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">twe</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">we_all</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">portfolio_std_1</span><span class="op">=</span><span class="op">(</span><span class="va">twe</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">portfolio_std</span><span class="op">*</span><span class="fl">252</span><span class="op">)</span><span class="op">^</span><span class="fl">.5</span></span></code></pre></div>
<p>The following code has the annualized returns of the in_sample data, only for the momentum portfolio.</p>
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dame los rendimeinto sanualizados (que están en la priemra columna de df_merge2, pero solo los de los tickers de co_all)</span></span>
<span><span class="va">ret_a</span><span class="op">&lt;-</span><span class="va">df_merge2</span><span class="op">[</span><span class="va">co_all</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#mult por los pesos por los rendimientos para obtener rendimiento del portafoilo, con estos pesos simulados</span></span>
<span><span class="va">ret_a_f</span><span class="op">&lt;-</span><span class="va">twe</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">ret_a</span> <span class="co"># twe es el vector de pesos trasnpuesto </span></span>
<span><span class="va">ret_a_f</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.1818727</span></span></code></pre></div>
<div id="graphs-of-the-results" class="section level3" number="9.0.1">
<h3>
<span class="header-section-number">9.0.1</span> Graphs of the results<a class="anchor" aria-label="anchor" href="#graphs-of-the-results"><i class="fas fa-link"></i></a>
</h3>
<p>The next code creates a plot of the simulations, highlighting the higher sharp ratio portfolio (red circle).</p>
<p>lines(df[1,1],df[1,2],col=“red”,type=“p”,cex=1.5,pch=16)</p>
<p>The next code shows the portfolio with max sharp.</p>
</div>
<div id="bibliography-3" class="section level2" number="9.1">
<h2>
<span class="header-section-number">9.1</span> Bibliography<a class="anchor" aria-label="anchor" href="#bibliography-3"><i class="fas fa-link"></i></a>
</h2>
<p>Cervantes, M., Montoya, M. Á., &amp; Bernal Ponce, L. A. (2016). Effect of the Business Cycle on Investment Strategies: Evidence from Mexico. Revista Mexicana de Economía y Finanzas, 11(2).</p>
<p>Hilpisch (2019). Python for Finance, 2nd Edition. O’Reilly Media, Inc. Sebastopol, CA.</p>

<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-rstudio" class="csl-entry">
Ismay, Chester, and Albert Y. Kim. 2019. <em>Statistical Inference via Data Science</em>. CRC Press. <a href="https://moderndive.netlify.app/index.html">https://moderndive.netlify.app/index.html</a>.
</div>
<div id="ref-statistical_lerarning" class="csl-entry">
James, Witten, G, and R Tibshirani. 2017. <em>An Introduction to Statistical Learning with Applications in r</em>. Springer. <a href="https://www.springer.com/series/417">https://www.springer.com/series/417</a>.
</div>
<div id="ref-R-caret" class="csl-entry">
Kuhn, Max. 2019. <em>The Caret Package</em>. <a href="https://topepo.github.io/caret/index.html">https://topepo.github.io/caret/index.html</a>.
</div>
<div id="ref-introduction-R" class="csl-entry">
Team, R Core. 2022. <em>An Introduction to r</em>. <a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html">https://cran.r-project.org/doc/manuals/r-release/R-intro.html</a>.
</div>
<div id="ref-wooldridge" class="csl-entry">
Wooldridge, Jeffrey M. 2020. <em>Introductory Econometrics: A Modern Approach</em>. South-Western Cengage Learning.
</div>
<div id="ref-R-Markdown" class="csl-entry">
Yihui Xie, J. J. Allaire, and Garrett Grolemund. 2019. <em>R Markdown: The Definitive Guide</em>. Chapman &amp; Hall/CRC. <a href="https://bookdown.org/yihui/rmarkdown/">https://bookdown.org/yihui/rmarkdown/</a>.
</div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="momentum-or-directional-trading.html"><span class="header-section-number">8</span> Momentum or directional trading</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li>
<a class="nav-link" href="#portfolio-management-algorithms"><span class="header-section-number">9</span> Portfolio management algorithms</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#graphs-of-the-results"><span class="header-section-number">9.0.1</span> Graphs of the results</a></li></ul>
</li>
<li><a class="nav-link" href="#bibliography-3"><span class="header-section-number">9.1</span> Bibliography</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/datanalyticss/bookAFMR/blob/master/09-Portfolio-management-algorithms.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/datanalyticss/bookAFMR/edit/master/09-Portfolio-management-algorithms.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Algorithms and Financial programing in R</strong>" was written by Arturo Bernal. It was last built on 2022-07-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
