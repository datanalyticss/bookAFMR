<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3 APIS and R graphs | Algorithms and Financial programing in R</title>
<meta name="author" content="Arturo Bernal">
<meta name="description" content="We have pending the contents: reviewing categories in a column of a data frame (DF); - Filtering in a column of a “DF; - Conditional function”ifelse”; - Detecting and replacing missing values; -...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="3 APIS and R graphs | Algorithms and Financial programing in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.arturo-bernal.com/book/graphs.html">
<meta property="og:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<meta property="og:description" content="We have pending the contents: reviewing categories in a column of a data frame (DF); - Filtering in a column of a “DF; - Conditional function”ifelse”; - Detecting and replacing missing values; -...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3 APIS and R graphs | Algorithms and Financial programing in R">
<meta name="twitter:description" content="We have pending the contents: reviewing categories in a column of a data frame (DF); - Filtering in a column of a “DF; - Conditional function”ifelse”; - Detecting and replacing missing values; -...">
<meta name="twitter:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Roboto-0.4.1/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68765210-2', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Algorithms and Financial programing in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Algorithms and Financial programing in R</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> R Basics</a></li>
<li><a class="" href="clean.html"><span class="header-section-number">2</span> Big data and data cleaning</a></li>
<li><a class="active" href="graphs.html"><span class="header-section-number">3</span> APIS and R graphs</a></li>
<li><a class="" href="logit.html"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></li>
<li><a class="" href="big-data-and-machine-learning.html"><span class="header-section-number">5</span> Big data and machine learning</a></li>
<li><a class="" href="credit-analysis.html"><span class="header-section-number">6</span> Credit analysis</a></li>
<li><a class="" href="rational-agent-and-behavioral-finance-in-investment.html"><span class="header-section-number">7</span> Rational agent and behavioral finance in investment</a></li>
<li><a class="" href="momentum-or-directional-trading.html"><span class="header-section-number">8</span> Momentum or directional trading</a></li>
<li><a class="" href="portfolio-management-algorithms.html"><span class="header-section-number">9</span> Portfolio management algorithms</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/datanalyticss/bookAFMR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="graphs" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> APIS and R graphs<a class="anchor" aria-label="anchor" href="#graphs"><i class="fas fa-link"></i></a>
</h1>
<p>We have pending the contents:
reviewing categories in a column of a data frame (DF);
- Filtering in a column of a “DF;
- Conditional function”ifelse”;
- Detecting and replacing missing values;
- Estimating mean, media;
- Replacing missing values by a value such as as a median, mean, etc; or eliminating rows in a missing values.</p>
<p>We will cover those contents while we cover the other contents.</p>
<div id="apis-apis-application-programming-interface" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> 1. APIs API´s (Application Programming Interface)<a class="anchor" aria-label="anchor" href="#apis-apis-application-programming-interface"><i class="fas fa-link"></i></a>
</h2>
<p>Descargar de Canvas: R graphs and data bases a.Rmd</p>
<div id="quantmod-api" class="section level3" number="3.1.1">
<h3>
<span class="header-section-number">3.1.1</span> 1.1 Quantmod API<a class="anchor" aria-label="anchor" href="#quantmod-api"><i class="fas fa-link"></i></a>
</h3>
<p>Quantitative Financial Modelling Framework</p>
<p>The quantmod package for R is designed to assist the quantitative trader in the development, testing,
and deployment of statistically based trading models.</p>
<p>The function getSymbols is a wrapper to load data from various sources, local or remote.</p>
<p>Getting a tikcer from <a href="https://finance.yahoo.com/" class="uri">https://finance.yahoo.com/</a>
getSymbols(“Symbol”)</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.quantmod.com">quantmod</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="st">"AAPL"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">AAPL</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "xts" "zoo"</span></span>
<span></span>
<span><span class="co"># objetos xts son como data frames, solo que la fecha del precio es el índice</span></span></code></pre></div>
<p>To eliminate warnings, we could add the argument warnings = F</p>
<p>Getting the data from an specific date:</p>
<p>getSymbols(“symbol”, from=“YY/m/d”,to=“YY/m/d”)</p>
<p>Where: YY= is 4 digit year, m= 2 digit month, d= 2 digit day.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="st">"AMZN"</span>, from<span class="op">=</span><span class="st">"2020/04/01"</span>,to<span class="op">=</span><span class="st">"2022/04/04"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AMZN"</span></span></code></pre></div>
<p>An xts class of object provide for uniform handling of R’s different time-based data classes.</p>
<p>Into an environment
data &lt;- new.env()
getSymbols(“ticker”,env=data)</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># otra forma de descrgar los datos, dandole nombre al objeto</span></span>
<span><span class="va">apple2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="st">"AAPL"</span>, env<span class="op">=</span><span class="va">apple2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">apple2</span><span class="op">)</span> <span class="co"># el objeto apple2, es un environmte o una lista, almacena varios tipos de objetos.</span></span>
<span><span class="co">#&gt; [1] "environment"</span></span></code></pre></div>
<p>Intraday from
<a href="https://www.alphavantage.co/" class="uri">https://www.alphavantage.co/</a></p>
<p>getSymbols(“ticker”, src=“av”, api.key=“yourKey”, output.size=“full”,
periodicity=“intraday”)</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="st">"AAPL"</span>, src<span class="op">=</span><span class="st">"av"</span>, api.key<span class="op">=</span><span class="st">"yourKey"</span>, output.size<span class="op">=</span><span class="st">"full"</span>,</span>
<span>periodicity<span class="op">=</span><span class="st">"intraday"</span>,interval<span class="op">=</span><span class="st">"5min"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL"</span></span></code></pre></div>
<p>Dividends
getDividends(“ticker”), the xts objetc if the ticker needs to be in the R environment</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Al parecer solo si ticker tiene iformación de divididendos</span></span>
<span><span class="va">ap_div</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getDividends.html">getDividends</a></span><span class="op">(</span><span class="st">"AAPL"</span><span class="op">)</span></span></code></pre></div>
<p>Descargar a m</p>
<p>i PC en xlsx o en csv</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#write.csv(AMZN,"MY_AMZN.csv")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/write.xlsx.html">write.xlsx</a></span><span class="op">(</span><span class="va">AMZN</span>,<span class="st">"MY_AMZN.xlsx"</span><span class="op">)</span></span></code></pre></div>
<p>Break de 10 min, regresamos a las 12,
regresamos para kahoot</p>
</div>
<div id="in-house-api" class="section level3" number="3.1.2">
<h3>
<span class="header-section-number">3.1.2</span> 1.2 In-house Api<a class="anchor" aria-label="anchor" href="#in-house-api"><i class="fas fa-link"></i></a>
</h3>
<p>(this will not be covered in the final exam or activities, is only for exposition)</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span></span></code></pre></div>
<p>Harvesting the web with rvest (to get tickers)</p>
<p>This code is to read characters from web pages. In this case, to get the tickers from yahoo finance.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the page of of the criptocurrencies</span></span>
<span><span class="co">#yf &lt;- "https://finance.yahoo.com/cryptocurrencies/"</span></span>
<span></span>
<span><span class="co"># for the IPC components</span></span>
<span><span class="va">yf</span> <span class="op">&lt;-</span> <span class="st">"https://finance.yahoo.com/quote/%5EMXX/components?p=%5EMXX"</span></span>
<span><span class="va">html</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">yf</span><span class="op">)</span></span>
<span><span class="co"># To get the node a, wich contains characters </span></span>
<span><span class="va">node</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="va">html</span>,<span class="st">"a"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To read the text in the node</span></span>
<span><span class="va">node</span><span class="op">&lt;-</span><span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html">html_text</a></span><span class="op">(</span><span class="va">node</span>, trim<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To get the elements that have USD (the tickers). For the IPC tickers, replace "USD" with ".MX". For other tickers, print the node object and look for patterns or select by rows.</span></span>
<span><span class="co">#tickers&lt;-grep(pattern = "USD", x = node, value = TRUE)</span></span>
<span></span>
<span><span class="va">tickers</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".MX"</span>, x <span class="op">=</span> <span class="va">node</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to get only the first 5 tickers</span></span>
<span></span>
<span><span class="va">tickers1</span><span class="op">&lt;-</span><span class="va">tickers</span></span>
<span><span class="va">tickers1</span></span>
<span><span class="co">#&gt;  [1] "IENOVA.MX"     "AMXL.MX"       "ASURB.MX"      "GCC.MX"       </span></span>
<span><span class="co">#&gt;  [5] "TLEVISACPO.MX" "MEGACPO.MX"    "GFNORTEO.MX"   "FEMSAUBD.MX"  </span></span>
<span><span class="co">#&gt;  [9] "GMEXICOB.MX"   "GENTERA.MX"    "GCARSOA1.MX"   "LABB.MX"      </span></span>
<span><span class="co">#&gt; [13] "BBAJIOO.MX"    "GRUMAB.MX"     "GAPB.MX"       "PINFRA.MX"    </span></span>
<span><span class="co">#&gt; [17] "AC.MX"         "CEMEXCPO.MX"   "OMAB.MX"       "ALSEA.MX"     </span></span>
<span><span class="co">#&gt; [21] "KIMBERA.MX"    "BOLSAA.MX"     "CUERVO.MX"     "BIMBOA.MX"    </span></span>
<span><span class="co">#&gt; [25] "ALPEKA.MX"     "LIVEPOLC1.MX"  "MEXCHEM.MX"    "KOFL.MX"      </span></span>
<span><span class="co">#&gt; [29] "PEOLES.MX"     "SITESB1.MX"</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">tickers1</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "IENOVA.MX" "AMXL.MX"</span></span></code></pre></div>
</div>
<div id="nasdaq-data-link-api" class="section level3" number="3.1.3">
<h3>
<span class="header-section-number">3.1.3</span> 1.3 Nasdaq Data Link API<a class="anchor" aria-label="anchor" href="#nasdaq-data-link-api"><i class="fas fa-link"></i></a>
</h3>
<p>You need to create an account (I suggest for you a free academic account)</p>
<p>Nasdaq Data Link API (before it eas Quandl) <a href="https://data.nasdaq.com/" class="uri">https://data.nasdaq.com/</a></p>
<p>The class of objects from Quandl are Data Frames, but if e add the argument: type=“xts”, an xts object we get.</p>
<p>Emerging Markets High Grade Corporate Bond Index Yield</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quandl/quandl-r">Quandl</a></span><span class="op">)</span></span>
<span><span class="co"># por default como data frame, pero podemos darle unargumento para que sea xts la descarga</span></span>
<span><span class="va">eurex</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/Quandl/man/Quandl.html">Quandl</a></span><span class="op">(</span><span class="st">"ML/EMHGY"</span>, api_key<span class="op">=</span><span class="st">"e7Z7FD5siZ8mDi_yTVLD"</span>,type<span class="op">=</span><span class="st">"xts"</span><span class="op">)</span></span>
<span><span class="co"># api_key </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">eurex</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]</span></span>
<span><span class="co">#&gt; 1998-12-31 8.48</span></span>
<span><span class="co">#&gt; 1999-01-04 8.48</span></span>
<span><span class="co">#&gt; 1999-01-05 8.46</span></span>
<span><span class="co">#&gt; 1999-01-06 8.37</span></span>
<span><span class="co">#&gt; 1999-01-07 8.43</span></span>
<span><span class="co">#&gt; 1999-01-08 8.40</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tickers</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="databases-handling-xts-objects" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> 2. databases handling (xts objects)<a class="anchor" aria-label="anchor" href="#databases-handling-xts-objects"><i class="fas fa-link"></i></a>
</h2>
<p>Subset by year, for example 2015
object[“year”]</p>
<p>tickers&lt;-c(“AAPL”,“AMZN”)</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tickers</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>,<span class="st">"AMZN"</span><span class="op">)</span></span>
<span><span class="co"># vector de caracteres</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL" "AMZN"</span></span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># que app solo tuvses el precio de cierre de apple</span></span>
<span><span class="va">app</span><span class="op">&lt;-</span><span class="va">AAPL</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="co"># juntar precio de cierre de apple y de amazon en un osolo objeto, usando cbind</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">app</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100   1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">AMZN</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3911    6</span></span>
<span><span class="co"># CON OBJETOS XTS SI PUEDO USAR cbind para combinar estos dos objetos aunque tenga diferente dimension</span></span>
<span><span class="co"># voy a genera o tro ojeto que sea precio de cierre de amz</span></span>
<span><span class="va">am</span><span class="op">&lt;-</span><span class="va">AMZN</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">both</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">app</span>,<span class="va">am</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="co">#&gt;            AAPL.Close AMZN.Close</span></span>
<span><span class="co">#&gt; 2007-01-03   2.992857     1.9350</span></span>
<span><span class="co">#&gt; 2007-01-04   3.059286     1.9450</span></span>
<span><span class="co">#&gt; 2007-01-05   3.037500     1.9185</span></span>
<span><span class="co">#&gt; 2007-01-08   3.052500     1.8750</span></span>
<span><span class="co">#&gt; 2007-01-09   3.306071     1.8890</span></span>
<span><span class="co">#&gt; 2007-01-10   3.464286     1.8575</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="co">#&gt;            AAPL.Close AMZN.Close</span></span>
<span><span class="co">#&gt; 2022-07-08         NA     115.54</span></span>
<span><span class="co">#&gt; 2022-07-11         NA     111.75</span></span>
<span><span class="co">#&gt; 2022-07-12         NA     109.22</span></span>
<span><span class="co">#&gt; 2022-07-13         NA     110.40</span></span>
<span><span class="co">#&gt; 2022-07-14         NA     110.63</span></span>
<span><span class="co">#&gt; 2022-07-15         NA     113.55</span></span>
<span><span class="co"># na son missin values o datos faltantes</span></span></code></pre></div>
<p>Merging xts objects. We mentioned before that the data frames could not be merged spplying cbind when do not have the same numbers of rows. The xts objects can be merged even when it does not have the same numbers of rows, because are merged by their index (the dates).</p>
<p>Making Subset in xts objects.</p>
<p>name&lt;-subset(object,
+index(object)&gt;=“YY-mm-dd” &amp;
+index(object)&lt;=“YY-mm-dd”)</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.quantmod.com">quantmod</a></span><span class="op">)</span></span>
<span><span class="va">tickers</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>,<span class="st">"AMZN"</span><span class="op">)</span></span>
<span><span class="co"># vector de caracteres</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL" "AMZN"</span></span>
<span><span class="va">app</span><span class="op">&lt;-</span><span class="va">AAPL</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">am</span><span class="op">&lt;-</span><span class="va">AMZN</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">both</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">app</span>,<span class="va">am</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="co">#&gt;            AAPL.Close AMZN.Close</span></span>
<span><span class="co">#&gt; 2007-01-03   2.992857     1.9350</span></span>
<span><span class="co">#&gt; 2007-01-04   3.059286     1.9450</span></span>
<span><span class="co">#&gt; 2007-01-05   3.037500     1.9185</span></span>
<span><span class="co">#&gt; 2007-01-08   3.052500     1.8750</span></span>
<span><span class="co">#&gt; 2007-01-09   3.306071     1.8890</span></span>
<span><span class="co">#&gt; 2007-01-10   3.464286     1.8575</span></span>
<span><span class="co"># crear un subset de periodo 7 de marzo al 7 de abril 2022</span></span>
<span><span class="co"># primer arguemnto nombre del objecto</span></span>
<span><span class="va">sub_1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">both</span>,</span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span><span class="op">&gt;=</span><span class="st">"2022-03-07"</span> <span class="op">&amp;</span></span>
<span>  <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html">index</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span><span class="op">&lt;=</span><span class="st">"2022-04-07"</span><span class="op">)</span></span>
<span><span class="va">sub_1</span></span>
<span><span class="co">#&gt;            AAPL.Close AMZN.Close</span></span>
<span><span class="co">#&gt; 2022-03-07     159.30   137.4530</span></span>
<span><span class="co">#&gt; 2022-03-08     157.44   136.0145</span></span>
<span><span class="co">#&gt; 2022-03-09     162.95   139.2790</span></span>
<span><span class="co">#&gt; 2022-03-10     158.52   146.8175</span></span>
<span><span class="co">#&gt; 2022-03-11     154.73   145.5245</span></span>
<span><span class="co">#&gt; 2022-03-14     150.62   141.8530</span></span>
<span><span class="co">#&gt; 2022-03-15     155.09   147.3665</span></span>
<span><span class="co">#&gt; 2022-03-16     159.59   153.1040</span></span>
<span><span class="co">#&gt; 2022-03-17     160.62   157.2390</span></span>
<span><span class="co">#&gt; 2022-03-18     163.98   161.2505</span></span>
<span><span class="co">#&gt; 2022-03-21     165.38   161.4915</span></span>
<span><span class="co">#&gt; 2022-03-22     168.82   164.8890</span></span>
<span><span class="co">#&gt; 2022-03-23     170.21   163.4080</span></span>
<span><span class="co">#&gt; 2022-03-24     174.07   163.6495</span></span>
<span><span class="co">#&gt; 2022-03-25     174.72   164.7735</span></span>
<span><span class="co">#&gt; 2022-03-28     175.60   168.9905</span></span>
<span><span class="co">#&gt; 2022-03-29     178.96   169.3150</span></span>
<span><span class="co">#&gt; 2022-03-30     177.77   166.3010</span></span>
<span><span class="co">#&gt; 2022-03-31     174.61   162.9975</span></span>
<span><span class="co">#&gt; 2022-04-01     174.31   163.5600</span></span>
<span><span class="co">#&gt; 2022-04-04     178.44   168.3465</span></span>
<span><span class="co">#&gt; 2022-04-05     175.06   164.0550</span></span>
<span><span class="co">#&gt; 2022-04-06     171.83   158.7560</span></span>
<span><span class="co">#&gt; 2022-04-07     172.14   157.7845</span></span></code></pre></div>
<p>In financial series it is common to converts an xts object into a lower periodicity (e.g., days converted to months or years) specified by period with the OHLC statistics. It could work for OHLC objects: “Open”, “High”, “Low”, “Close”, “Volume”, or “Adjusted”.</p>
<p>The function to.period takes the last day of the time series, is not the average.</p>
<p>to.period(object, period = “months”, OHLC = T)</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># supports: "seconds", "minutes", "hours", "days", "weeks", "months", "quarters", and "years".</span></span>
<span><span class="co"># vamos a convertir  app en datos semanales</span></span>
<span><span class="co">#OHLC CONTIENEN LA INFORMACION DE apertura, cierre, volumne, etc</span></span>
<span><span class="va">app_2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/xts/man/to.period.html">to.period</a></span><span class="op">(</span><span class="va">app</span>, period <span class="op">=</span> <span class="st">"weeks"</span>, OHLC <span class="op">=</span><span class="cn">T</span> <span class="op">)</span></span>
<span><span class="co"># si OHLC T entonces me incorpora precios de apertura, cierre, volumen, etc (los mismis que vienen de origen de getSymbol, si F, entonces solo el precio que vienene en el objecto)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">app_2</span><span class="op">)</span></span>
<span><span class="co">#&gt;            app.Open app.High  app.Low app.Close</span></span>
<span><span class="co">#&gt; 2007-01-05 2.992857 3.059286 2.992857  3.037500</span></span>
<span><span class="co">#&gt; 2007-01-12 3.052500 3.464286 3.052500  3.379286</span></span>
<span><span class="co">#&gt; 2007-01-19 3.467857 3.467857 3.160714  3.160714</span></span>
<span><span class="co">#&gt; 2007-01-26 3.099643 3.099643 3.049286  3.049286</span></span>
<span><span class="co">#&gt; 2007-02-02 3.069286 3.069286 3.026429  3.026786</span></span>
<span><span class="co">#&gt; 2007-02-09 2.997857 3.077857 2.973929  2.973929</span></span></code></pre></div>
</div>
<div id="graphs-plots" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> 3. Graphs (Plots)<a class="anchor" aria-label="anchor" href="#graphs-plots"><i class="fas fa-link"></i></a>
</h2>
<p>The basic function for ploting is plot(x, type = “h”, col = “red”, lwd = 10, “xlab”,“ylab”).
In help plot.xy and plot.default we can see the arguments.
Plot the HSI close price
<img src="03-APIS-and-graphs_files/figure-html/unnamed-chunk-17-1.png" width="90%" style="display: block; margin: auto;"><img src="03-APIS-and-graphs_files/figure-html/unnamed-chunk-17-2.png" width="90%" style="display: block; margin: auto;"><img src="03-APIS-and-graphs_files/figure-html/unnamed-chunk-17-3.png" width="90%" style="display: block; margin: auto;"></p>
<p>Adding another vector of information (another stock price, for example)
lines</p>
<p>We use lines to add another time serie</p>
<p>Adding leggend</p>
<p>The function legends only work with data frames, not xts., then we transform it in dataframe
as.data.frame(object)</p>
<p>legend(x= “topleft”, legend = c(“objst”,“objt2”),lty = 1,col=c(“green”,“red”))</p>
<p>For more details of legends look in <a href="http://www.sthda.com/english" class="uri">http://www.sthda.com/english</a>, for the legend function arguments.</p>
<p>De los temas pendientes, el de detectar valores faltantes (missing values o NA´s) y estimar medidas como la media, mediana, etc.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tickers</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AAPL"</span>,<span class="st">"AMZN"</span><span class="op">)</span></span>
<span><span class="co"># vector de caracteres</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">tickers</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "AAPL" "AMZN"</span></span>
<span><span class="va">app</span><span class="op">&lt;-</span><span class="va">AAPL</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">am</span><span class="op">&lt;-</span><span class="va">AMZN</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">110</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">both</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">app</span>,<span class="va">am</span><span class="op">)</span> </span>
<span><span class="co"># primra forma de viuzalizar si existen mising valus</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Index              AAPL.Close      AMZN.Close   </span></span>
<span><span class="co">#&gt;  Min.   :2007-01-03   Min.   :2.974   Min.   :1.821  </span></span>
<span><span class="co">#&gt;  1st Qu.:2007-02-12   1st Qu.:3.080   1st Qu.:1.919  </span></span>
<span><span class="co">#&gt;  Median :2007-03-22   Median :3.252   Median :2.012  </span></span>
<span><span class="co">#&gt;  Mean   :2007-03-23   Mean   :3.326   Mean   :2.367  </span></span>
<span><span class="co">#&gt;  3rd Qu.:2007-05-01   3rd Qu.:3.422   3rd Qu.:3.065  </span></span>
<span><span class="co">#&gt;  Max.   :2007-06-11   Max.   :4.058   Max.   :3.683  </span></span>
<span><span class="co">#&gt;                       NA's   :10</span></span></code></pre></div>
<p>Otra forma de detectar si tenemos datos faltantes es con función is.na()</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 10</span></span></code></pre></div>
<p>Que puedo hacer para coregir el tema de los misisng values
1. Elimiar todo el renglón con fuión na.omit()</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">both_2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">both_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">both</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 110   2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">both_2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100   2</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Alternativa 2, es reemplazar los missing values por alguna medida como la media, mediana</li>
</ol>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># estimar la media y la media de primera collumna de both</span></span>
<span><span class="co"># función mean(objeto)</span></span>
<span><span class="va">me</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">both</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co"># na.rm=T entonces, amite los nas, y realizae el calculo, si na.rm=F no realices elc alculo y arroja NA</span></span>
<span><span class="va">med</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">both</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">med</span></span>
<span><span class="co">#&gt; [1] 3.251786</span></span></code></pre></div>
<ul>
<li>Conditional function “ifelse”;</li>
<li>Detecting and replacing missing values;</li>
<li>Estimating mean, media;</li>
<li>Replacing missing values by a value such as as a median, mean, etc; or eliminating rows in a missing values.</li>
<li>Filtering in a column of a “DF;</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="clean.html"><span class="header-section-number">2</span> Big data and data cleaning</a></div>
<div class="next"><a href="logit.html"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#graphs"><span class="header-section-number">3</span> APIS and R graphs</a></li>
<li>
<a class="nav-link" href="#apis-apis-application-programming-interface"><span class="header-section-number">3.1</span> 1. APIs API´s (Application Programming Interface)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#quantmod-api"><span class="header-section-number">3.1.1</span> 1.1 Quantmod API</a></li>
<li><a class="nav-link" href="#in-house-api"><span class="header-section-number">3.1.2</span> 1.2 In-house Api</a></li>
<li><a class="nav-link" href="#nasdaq-data-link-api"><span class="header-section-number">3.1.3</span> 1.3 Nasdaq Data Link API</a></li>
</ul>
</li>
<li><a class="nav-link" href="#databases-handling-xts-objects"><span class="header-section-number">3.2</span> 2. databases handling (xts objects)</a></li>
<li><a class="nav-link" href="#graphs-plots"><span class="header-section-number">3.3</span> 3. Graphs (Plots)</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/datanalyticss/bookAFMR/blob/master/03-APIS-and-graphs.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/datanalyticss/bookAFMR/edit/master/03-APIS-and-graphs.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Algorithms and Financial programing in R</strong>" was written by Arturo Bernal. It was last built on 2022-07-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
